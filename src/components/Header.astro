---
import { Icon } from "astro-icon/components";

const baseUrl = import.meta.env.BASE_URL;
const withBase = (path: string) => `${baseUrl.replace(/\/$/, "")}/${path.replace(/^\//, "")}`;
const basePath = baseUrl.replace(/\/$/, "");
const currentPath = Astro.url.pathname.replace(basePath, "") || "/";

const navItems = [
  { href: withBase("/"), label: "Главная", path: "/" },
  { href: withBase("/kristina"), label: "Дементьева Кристина", path: "/kristina" },
  { href: withBase("/roman"), label: "Жданов Роман", path: "/roman" },
  { href: withBase("/contact"), label: "Контакты", path: "/contact" }
];
---
<header class="site-header sticky top-0 z-40 w-full">
  <div class="container-tight flex flex-wrap items-center gap-4 py-3 sm:py-4">
    <a href={withBase("/")} class="flex flex-col items-start gap-1 text-left focus-ring">
      <span class="text-lg font-semibold tracking-tight sm:text-xl">Окей Кристи Production</span>
      <span class="text-xs uppercase tracking-[0.35em] text-muted">Маркетинг · Продюсирование · Автоматизация</span>
    </a>
    <nav class="hidden items-center gap-2 text-sm font-medium lg:flex">
      {navItems.map((item) => {
        const isActive = currentPath === item.path;
        return (
          <a
            class={`rounded-full px-4 py-2 transition focus-ring ${
              isActive
                ? "bg-white/10 text-text shadow-[0_0_0_1px_rgba(255,255,255,0.08)]"
                : "text-muted hover:bg-white/5 hover:text-text"
            }`}
            href={item.href}
            aria-current={isActive ? "page" : undefined}
          >
            {item.label}
          </a>
        );
      })}
    </nav>
    <button
      class="lg:hidden flex h-11 w-11 items-center justify-center rounded-full border border-stroke/70 bg-black/20 shadow-[0_10px_30px_rgba(0,0,0,0.25)] focus-ring"
      aria-label="Открыть меню"
      data-menu-toggle
      type="button"
    >
      <Icon name="lucide:menu" class="h-5 w-5" aria-hidden="true" />
    </button>
  </div>
  <div
    class="fixed inset-0 z-[70] hidden bg-bg/95 backdrop-blur"
    data-menu-overlay
  >
    <div class="container-tight flex h-full flex-col gap-6 py-10" data-menu-content>
      <div class="flex items-center justify-between">
        <span class="text-lg font-semibold">Меню</span>
        <button
          class="flex h-11 w-11 items-center justify-center rounded-full border border-stroke/70 bg-black/20 focus-ring"
          aria-label="Закрыть меню"
          data-menu-close
          type="button"
        >
          <Icon name="lucide:x" class="h-5 w-5" aria-hidden="true" />
        </button>
      </div>
      <nav class="flex flex-col gap-4 text-base font-medium">
        {navItems.map((item) => {
          const isActive = currentPath === item.path;
          return (
            <a
              class={`focus-ring ${isActive ? "text-text" : ""}`}
              href={item.href}
              data-menu-link
              aria-current={isActive ? "page" : undefined}
            >
              {item.label}
            </a>
          );
        })}
      </nav>
    </div>
  </div>
</header>
